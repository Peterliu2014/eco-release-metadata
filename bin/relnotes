#!/bin/bash

old=$1
new=$2

src=${HOME}/src/aw-github/hadoop/dev-support
hrmd=${HOME}/Src/aw-github/hadoop-release-metadata

if [[ ! -e "${src}/relnotes-md.py" ]]; then
  echo "no relnotes-md.py"
  exit 1
fi

"${src}/relnotes-md.py" --previousVer "${old}" --version "${new}"
"${src}/changes-md.py" --version "${new}"

mkdir -p "${hrmd}/${new}/"

for i in *.md
do
  j=$(echo "${i}" | sed -e "s,.${new},,g")
  mv "${i}" "${hrmd}/${new}/${j}"
done
oldp=$(pwd)
cd "${hrmd}"
d=$(date -u "+%Y-%m-%d %H:%m")
git add "${new}/*"
git commit -a -m "${d} UTC auto-commit"
cd "${oldp}"
#git push
